{"version":3,"sources":["reducers/references.js","reducers/visibilityFilter.js","reducers/library.js","reducers/citation.js","reducers/editReferenceScreen.js","reducers/index.js","actions/index.js","components/CitationModal.js","common/referenceFields.js","components/Editable.js","components/DateEdit.js","common/nameSubFields.js","components/EditableNameList.js","components/FileList.js","components/EditReferenceScreen.js","components/Reference.js","components/ReferenceList.js","containers/VisibleReferenceList.js","components/MainScreen.js","components/App.js","index.js"],"names":["references","state","arguments","length","undefined","action","type","json","map","ref","id","reduce","v","pv","reference","Object","objectSpread","newReferenceData","concat","toConsumableArray","visibilityFilter","filter","library","isFetching","hasFailed","hasFailedCitationStyleList","hasFailedCitationLocale","hrefRoot","assign","path","citation","isVisible","refID","isFetchingLocale","citationLocale","isFetchingStyle","citationStyle","citationStyleName","citationStyleList","hasFailedCitation","xml","styleName","styleList","editReferenceScreen","referenceEditing","isModified","isShowingIDError","hasFailedUpdatedReference","fileList","showError","newRefEditing","defineProperty","key","value","newFileValue","field","split","f","index","join","newNameValue","a","newNameAdd","file","filesField","newNameRemove","newFileRemove","referenceApp","combineReducers","FileSaver","require","nextReferenceId","showEditScreen","dispatch","getState","fetch","then","resp","error","Error","refToEdit","r","console","log","IDErrorEditScreen","updateReference","encodeURIComponent","method","body","JSON","stringify","response","updateReferenceLocal","editReferenceField","requestLibrary","receiveLibrary","failReceiveLibrary","failReceiveCitationLocale","requestCitationLocale","receiveCitationLocale","fetchCitationStyle","requestCitationStyle","text","receiveCitationStyle","catch","failReceiveCitationStyle","receiveFilePathRoot","CSL","customStyles","content","top","left","right","bottom","marginRight","transform","height","CitationModal","_ref","react_default","createElement","lib_default","isOpen","onAfterOpen","onRequestClose","style","contentLabel","className","react_select_es","name","options","s","label","onChange","val","citeprocSys","retrieveLocale","lang","retrieveItem","citeproc","Engine","itemIDs","push","updateItems","bibEntry","makeBibliography","dangerouslySetInnerHTML","__html","citationContents","connect","referenceFields","hint","Editable","props","_this","classCallCheck","this","possibleConstructorReturn","getPrototypeOf","call","isEditing","e","isTextArea","cancel","save","setState","editing","refs","newText","onEdit","_this2","onClick","edit","toString","t","_this3","defaultValue","onBlur","onKeyDown","checkEnter","autoFocus","_this4","renderTextArea","renderForm","renderNormal","React","Component","DateEdit","yyyy","get_date_part_from_props","mm","dd","part","date_parts","dp","clearTimeout","focusBlurTimeout","result","event","persist","setTimeout","onBlurTimerHandler","_this5","onFocus","target","nameSubFields","EditableNameList","nameList","components_Editable","subField","onEditNameField","onDeleteName","onAddName","width","FileList","isShowingFilePickerModal","fileToAdd","fileText","fileHREF","fileObj","href","rel","files","onEditFileField","fileLink","onDeleteFile","openModal","allowableFileList","curF","onAddFile","closeModal","refFields","allowableTypes","modalContents","rf","data-tip","components_EditableNameList","isEditable","editNameField","addName","removeName","components_FileList","editFileField","removeFile","addFile","components_DateEdit","fieldContents","EditReferenceScreen","index_es","_getState3","newID","keys","k","curVal","constructor","Array","obj","total","trim","confirmAlert","title","message","confirmLabel","cancelLabel","onConfirm","onCancel","confirmCancel","react_confirm_alert_lib_default","IDError","Reference","isExpanded","date","filterRE","highlighted_text","show_name_list","show_date","fileTitle","field_contents","onShowYAML","doEditModal","onCitation","doExpand","author","literal","family","render_author_list_collapsed","number","issued","match","_this6","highlight_paragraph","searchFilter","RegExp","render_expanded","render_collapsed","ReferenceList","components_Reference","getVisibleReferences","uprFilter","toUpperCase","flt","includes","prevVal","elm","VisibleReferenceList","MainScreen","htmlFor","preventDefault","reader","FileReader","onload","biblatex","Promise","resolve","bibString","BibLatexParser","processUnexpected","processUnknown","collaborator","parser","output","intermediateJSON","cslJSON","CSLExporter","_step","tryToAdd","currentList","newItem","i","p","_iterator","_createForOfIteratorHelper","n","done","newRef","err","readAsText","blob","Blob","saveAs","size","containers_VisibleReferenceList","App","components_CitationModal","components_EditReferenceScreen","components_MainScreen","store","createStore","applyMiddleware","thunkMiddleware","receiveCitationStyleList","render","react_redux_es","components_App","document","getElementById"],"mappings":"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","file":"static/js/main.62269b3a.chunk.js","sourcesContent":["// Copyright (C) 2017, Stefan Kloppenborg\n//\n// This program is free software: you can redistribute it and/or modify\n// it under the terms of the GNU Affero General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU Affero General Public License for more details.\n//\n// You should have received a copy of the GNU Affero General Public License\n// along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nconst references = (state = [], action) => {\n  switch (action.type) {\n    case \"RECEIVE_LIBRARY\":\n      return action.json;\n    case \"UPDATE_REFERENCE\":\n      // check if the ID already exists\n      if (state.map(ref => (ref.id === action.id)).reduce((v, pv) => (v || pv), false)) {\n        // the id exists, so update it\n        return state.map(reference =>\n          (reference.id === action.id)\n            ? {...action.newReferenceData}\n            : reference\n        );\n      } else {\n        // it's a new id, so add it\n        return [\n          ...state,\n          action.newReferenceData\n        ]\n      }\n    default:\n      return state\n  }\n};\n\nexport default references\n","// Copyright (C) 2017, Stefan Kloppenborg\n//\n// This program is free software: you can redistribute it and/or modify\n// it under the terms of the GNU Affero General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU Affero General Public License for more details.\n//\n// You should have received a copy of the GNU Affero General Public License\n// along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nconst visibilityFilter = (state = \"\", action) => {\n  switch (action.type) {\n    case \"SET_FILTER_TEXT\":\n      return action.filter;\n    default:\n      return state\n  }\n};\n\nexport default visibilityFilter\n","// Copyright (C) 2017, Stefan Kloppenborg\n//\n// This program is free software: you can redistribute it and/or modify\n// it under the terms of the GNU Affero General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU Affero General Public License for more details.\n//\n// You should have received a copy of the GNU Affero General Public License\n// along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nconst library = (\n  state = {\n    isFetching: false,\n    hasFailed: false,\n    hasFailedCitationStyleList: false,\n    hasFailedCitationLocale: false,\n    hrefRoot: \"\"\n  },\n  action\n) => {\n  switch (action.type) {\n    case \"REQUEST_LIBRARY\":\n      return Object.assign({}, state, {\n        isFetching: true\n      });\n    case \"RECEIVE_LIBRARY\":\n      return Object.assign({}, state, {\n        isFetching: false\n      });\n    case \"FAIL_RECEIVE_LIBRARY\":\n      return Object.assign({}, state, {\n        isFetching: false,\n        hasFailed: true\n      });\n    case \"RECEIVE_FILE_PATH_ROOT\":\n      return Object.assign({}, state, {\n        hrefRoot: action.path\n      });\n    case \"FAIL_RECEIVE_CITATION_STYLE_LIST\":\n      return Object.assign({}, state, {\n        hasFailedCitationStyleList: true\n      });\n    case \"FAIL_RECEIVE_CITATION_LOCALE\":\n      return Object.assign({}, state, {\n        hasFailedCitationLocale: true\n      });\n    default:\n      return state\n  }\n};\n\nexport default library\n","// Copyright (C) 2017, Stefan Kloppenborg\n//\n// This program is free software: you can redistribute it and/or modify\n// it under the terms of the GNU Affero General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU Affero General Public License for more details.\n//\n// You should have received a copy of the GNU Affero General Public License\n// along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nconst citation = (\n  state = {\n    isVisible: false,\n    refID: \"\",\n    isFetchingLocale: false,\n    citationLocale: \"\",\n    isFetchingStyle: false,\n    citationStyle: \"\",\n    citationStyleName: \"\",\n    citationStyleList: [],\n    hasFailedCitation: false,\n    hasFailedCitationStyleList: false\n  },\n  action\n) => {\n  switch (action.type) {\n    case \"SHOW_CITATION\":\n      return Object.assign({}, state, {\n        isVisible: true,\n        refID: action.id\n      });\n    case \"DISMISS_CITATION\":\n      return Object.assign({}, state, {\n        isVisible: false,\n        refID: \"\"\n      });\n    case \"REQUEST_CITATION_LOCALE\":\n      return Object.assign({}, state, {\n        isFetchingLocale: true,\n        citationLocale: null\n      });\n    case \"RECEIVE_CITATION_LOCALE\":\n      return Object.assign({}, state, {\n        isFetchingLocale: false,\n        citationLocale: action.xml\n      });\n    case \"REQUEST_CITATION_STYLE\":\n      return Object.assign({}, state, {\n        isFetchingStyle: true,\n        citationStyle: null,\n        citationStyleName: \"\",\n        hasFailedCitation: false\n      });\n    case \"RECEIVE_CITATION_STYLE\":\n      return Object.assign({}, state, {\n        isFetchingStyle: false,\n        citationStyle: action.xml,\n        citationStyleName: action.styleName,\n        hasFailedCitation: false\n      });\n    case \"RECEIVE_CITATION_STYLE_LIST\":\n      return Object.assign({}, state, {\n        citationStyleList: action.styleList,\n        hasFailedCitationStyleList: false\n      });\n    case \"FAIL_RECEIVE_CITATION_STYLE_LIST\":\n      return Object.assign({}, state, {\n        hasFailedCitationStyleList: true\n      });\n    case \"FAIL_RECEIVE_CITATION_STYLE\":\n      return Object.assign({}, state, {\n        hasFailedCitation: true\n      });\n    default:\n      return state\n  }\n};\n\nexport default citation\n","// Copyright (C) 2017, Stefan Kloppenborg\n//\n// This program is free software: you can redistribute it and/or modify\n// it under the terms of the GNU Affero General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU Affero General Public License for more details.\n//\n// You should have received a copy of the GNU Affero General Public License\n// along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nconst editReferenceScreen = (state = {\n                               isVisible: false,\n                               refID: \"\",\n                               referenceEditing: null,\n                               isModified: false,\n                               isShowingIDError: false,\n                               hasFailedUpdatedReference: false,\n                               fileList: []\n                             },\n                             action) => {\n  switch (action.type) {\n    case \"SHOW_EDIT_SCREEN\":\n      return Object.assign({}, state, {\n        isVisible: true,\n        refID: action.id,\n        referenceEditing: Object.assign({}, action.reference),\n        isModified: false,\n        hasFailedUpdatedReference: false\n      });\n    case \"DISMISS_EDIT_SCREEN\":\n      return Object.assign({}, state, {\n        isVisible: false,\n        refID: \"\",\n        referenceEditing: null,\n        isModified: false\n      });\n    case \"FAIL_UPDATE_REFERENCE\":\n      return Object.assign({}, state, {\n        hasFailedUpdatedReference: true\n      });\n    case \"ID_ERROR_EDIT_SCREEN\":\n      return Object.assign({}, state, {\n        isShowingIDError: action.showError\n      });\n    case \"EDIT_REFERENCE_FIELD\":\n      if (!state.referenceEditing) {\n        return state;\n      }\n      const newRefEditing = Object.assign({}, state.referenceEditing, {[action.key]: action.value});\n      if(!action.value || action.value === \"\") {\n        delete newRefEditing[action.key]\n      }\n      return Object.assign({}, state, {\n        referenceEditing: newRefEditing,\n        isModified: state.isModified ||\n          !state.referenceEditing[action.key] ||\n          action.value !== state.referenceEditing[action.key]\n      });\n    case \"EDIT_FILE_FIELD\":\n      if (!state.referenceEditing) {\n        return state;\n      }\n\n      const newFileValue = state.referenceEditing[action.field].split(\";\").map((f, index) =>\n        index === action.index\n          ? action.value\n          : f\n      ).join(\";\");\n\n      return Object.assign({}, state, {\n        referenceEditing: Object.assign({}, state.referenceEditing, {\n          [action.field]: newFileValue\n        }),\n        isModified: state.isModified ||\n          !state.referenceEditing[action.field] ||\n          state.referenceEditing[action.field] !== newFileValue\n      });\n    case \"EDIT_NAME_FIELD\":\n      if (!state.referenceEditing) {\n        return state;\n      }\n      const newNameValue = state.referenceEditing[action.field].map((a, index) =>\n        index === action.index\n          ? Object.assign({}, a, {[action.key]: action.value})\n          : a\n      );\n      return Object.assign({}, state, {\n        referenceEditing: Object.assign({}, state.referenceEditing, {\n          [action.field]: newNameValue\n        }),\n        isModified: state.isModified ||\n          !state.referenceEditing[action.field][action.index][action.key] ||\n          state.referenceEditing[action.field][action.index][action.key] !== action.value\n      });\n    case \"ADD_NAME\":\n      if (!state.referenceEditing) {\n        return state;\n      }\n      const newNameAdd = !!state.referenceEditing[action.field]\n        ? [...state.referenceEditing[action.field], {}]\n        : [{}];\n      // Won't change the isModified flag until the user actually adds some text to the new name field\n      return Object.assign({}, state, {\n        referenceEditing: Object.assign({}, state.referenceEditing, {\n          [action.field]: newNameAdd\n        })\n      });\n    case \"ADD_FILE\":\n      if (!state.referenceEditing || action.file === \"\") {\n        return state;\n      }\n      const filesField = !!state.referenceEditing[action.field] ? state.referenceEditing[action.field].split(\";\") : [];\n      return Object.assign({}, state, {\n        referenceEditing: Object.assign({}, state.referenceEditing, {\n          [action.field]: [...filesField, action.file].join(\";\")\n        }),\n        isModified: true\n      });\n    case \"REMOVE_NAME\":\n      if (!state.referenceEditing) {\n        return state;\n      }\n      const newNameRemove = state.referenceEditing[action.field].filter((a, index) =>\n        index !== action.index\n      );\n      return Object.assign({}, state, {\n        referenceEditing: Object.assign({}, state.referenceEditing, {\n          [action.field]: newNameRemove\n        }),\n        isModified: true\n      });\n    case \"REMOVE_FILE\":\n      if (!state.referenceEditing) {\n        return state;\n      }\n      const newFileRemove = state.referenceEditing[action.field].split(\";\").filter((a, index) =>\n        index !== action.index\n      ).join(\";\");\n      return Object.assign({}, state, {\n        referenceEditing: Object.assign({}, state.referenceEditing, {\n          [action.field]: newFileRemove\n        }),\n        isModified: true\n      });\n    case \"RECEIVE_FILE_LIST\":\n      return Object.assign({}, state, {\n        fileList: action.json\n      });\n    default:\n      return state\n  }\n};\n\nexport default editReferenceScreen;\n","// Copyright (C) 2017, Stefan Kloppenborg\n//\n// This program is free software: you can redistribute it and/or modify\n// it under the terms of the GNU Affero General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU Affero General Public License for more details.\n//\n// You should have received a copy of the GNU Affero General Public License\n// along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nimport { combineReducers } from 'redux'\nimport references from './references'\nimport visibilityFilter from './visibilityFilter'\nimport library from './library'\nimport citation from './citation'\nimport editReferenceScreen from './editReferenceScreen'\n\nconst referenceApp = combineReducers({\n  library,\n  references,\n  visibilityFilter,\n  citation,\n  editReferenceScreen\n});\n\nexport default referenceApp\n","// Copyright (C) 2017, Stefan Kloppenborg\n//\n// This program is free software: you can redistribute it and/or modify\n// it under the terms of the GNU Affero General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU Affero General Public License for more details.\n//\n// You should have received a copy of the GNU Affero General Public License\n// along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nimport fetch from 'isomorphic-fetch'\n\n// const Cite = require('citation-js');\nimport { BibLatexParser, CSLExporter } from 'biblatex-csl-converter'\n\nconst FileSaver = require(\"file-saver\");\n\nlet nextReferenceId = 0;\n\nexport const addReference = () => {\n  return (dispatch, getState) => {\n    const { references } = getState();\n\n    while(references\n      // eslint-disable-next-line\n      .map(ref => ref.id === nextReferenceId.toString())\n      .reduce((prevVal, elm) => prevVal || elm, false)) {\n      ++nextReferenceId\n    }\n\n    dispatch(showEditScreen(nextReferenceId))\n  };\n};\n\nexport const setFilterText = filter => {\n  return {\n    type: \"SET_FILTER_TEXT\",\n    filter\n  }\n};\n\nexport function showEditScreen(id) {\n  return (dispatch, getState) => {\n    return fetch(\"http://localhost:5000/api/files?unlinked\")\n      .then(\n        resp => resp.json(),\n        error => {\n          throw new Error(\"Failed to file list\" + error)\n        }\n      )\n      .then(\n        json => {\n          dispatch({\n            type: \"RECEIVE_FILE_LIST\",\n            json\n          })\n        },\n        error => {\n          throw new Error(\"Failed to file list\" + error)\n        }\n      )\n      .then(\n        ()=> {\n          const {references} = getState();\n\n          const refToEdit = references.filter((r) => r.id === id)[0];\n\n          dispatch({\n            type: \"SHOW_EDIT_SCREEN\",\n            id: id,\n            reference: !!refToEdit ? refToEdit : {}\n          })\n        },\n        error => {\n          console.log(\"Failed to file list\", error)\n        }\n      )\n\n  }\n\n\n}\n\nexport function dismissEditScreen() {\n  return {\n    type: \"DISMISS_EDIT_SCREEN\"\n  }\n}\n\nexport function IDErrorEditScreen(showError) {\n  return {\n    type: \"ID_ERROR_EDIT_SCREEN\",\n    showError\n  }\n}\n\nexport function saveEditScreen() {\n  return (dispatch, getState) => {\n    const { editReferenceScreen, references } = getState();\n\n    if(editReferenceScreen.isModified) {\n      const id = editReferenceScreen.refID;\n      const newID = editReferenceScreen.referenceEditing.id;\n\n      // remove any empty fields from newReferenceData\n      const newReferenceData = Object.keys(editReferenceScreen.referenceEditing)\n        .filter(k => {\n          let curVal = editReferenceScreen.referenceEditing[k];\n          return (curVal !== \"\" &&\n            !(curVal.constructor === Object && Object.keys(curVal).length === 0) &&\n            !(curVal.constructor === Array && curVal.length === 0));\n        })\n        .reduce((obj, key) => {\n          obj[key] = editReferenceScreen.referenceEditing[key];\n          return obj;\n        }, {});\n\n      const idCount = references\n        .filter(r => r.id !== id)\n        .map(r => r.id === newID)\n        .reduce((v, total) => v + total, 0);\n\n      if (idCount > 0 || newID.trim() === \"\") {\n        dispatch(IDErrorEditScreen(true));\n      } else {\n        dispatch(updateReference(id, newReferenceData));\n      }\n    } else {\n      // not modified. Just exit.\n      dispatch(dismissEditScreen());\n    }\n  };\n}\n\nexport function updateReference(id, newReferenceData) {\n  return(dispatch) => {\n    return fetch(\n      \"http://localhost:5000/api/library/\" + encodeURIComponent(id),\n      {\n        method: \"PUT\",\n        body: JSON.stringify(newReferenceData)\n      }\n    )\n      .then(\n        response => {\n          dispatch(updateReferenceLocal(id, newReferenceData));\n          dispatch(dismissEditScreen());\n        },\n        error => dispatch(failUpdateReference())\n      )\n  };\n\n}\n\nexport function updateReferenceLocal(id, newReferenceData) {\n  return {\n    type: \"UPDATE_REFERENCE\",\n    id,\n    newReferenceData\n  }\n}\n\nexport function failUpdateReference() {\n  return {\n    type: \"FAIL_UPDATE_REFERENCE\"\n  }\n}\n\nexport const editReferenceField = (key, value) => {\n  return {\n    type: 'EDIT_REFERENCE_FIELD',\n    key: key,\n    value: value\n  }\n};\n\nexport const editFileField = (field, index, value) => {\n  return {\n    type: \"EDIT_FILE_FIELD\",\n    field,\n    index,\n    value\n  }\n};\n\nexport const removeFile = (field, index) => {\n  return {\n    type: 'REMOVE_FILE',\n    field,\n    index\n  }\n};\n\nexport const addFile = (field, file) => {\n  return {\n    type: \"ADD_FILE\",\n    field,\n    file\n  }\n};\n\nexport const editNameField = (field, index, key, value) => {\n  return {\n    type: \"EDIT_NAME_FIELD\",\n    field,\n    index,\n    key,\n    value\n  }\n};\n\nexport const addName = (field) => {\n  return {\n    type: 'ADD_NAME',\n    field\n  }\n};\n\nexport const removeName = (field, index) => {\n  return {\n    type: 'REMOVE_NAME',\n    field,\n    index\n  }\n};\n\nexport const requestLibrary = () => {\n  return {\n    type: \"REQUEST_LIBRARY\"\n  }\n};\n\nexport const receiveLibrary = (json) => {\n  return {\n    type: \"RECEIVE_LIBRARY\",\n    json\n  }\n};\n\nexport const failReceiveLibrary = () => {\n  return {\n    type: \"FAIL_RECEIVE_LIBRARY\"\n  }\n};\n\n\n/*\nThe citation.js implementation\n- Currently (OCt-2017), this only reads the fields defined in base BibTeX.\n  as such, things like the abstract and file (links) are not read. If\n  BibLaTeX is added to citation.js in the future, this code could be\n  re-introduced.\n\nexport function fetchLibrary() {\n  return function (dispatch) {\n    dispatch(requestLibrary());\n    return fetch(\"./library/MyLibrary.bib\")\n      .then(\n        response => response.text(),\n        error => console.log(\"Error fetching library\", error)\n      )\n      .then(\n        bibString => {\n          return new Cite(bibString, {\n            forceType: \"string/bibtex\"\n          })\n        }\n      )\n      .then(\n        parser => {\n          const csl = parser.get({\n            type: 'json',\n            style: 'csl'\n          });\n          return csl;\n        }\n      )\n      .then(\n        json => dispatch(receiveLibrary(json))\n      )\n  }\n}\n*/\n\n/*\nThe biblatex-csl-converter implementation\n- biblatex-csl-converter only converts from biblatex to CSL, not the other\n  way around, so this library cannot be used to save. Because of this fact,\n  this library should be abandoned\n*/\n/*\nexport function fetchLibrary() {\n  return function (dispatch) {\n    dispatch(requestLibrary());\n    return fetch(\"./library/MyLibrary.bib\")\n      .then(\n        response => response.text(),\n        error => console.log(\"Error fetching library\", error)\n      )\n      .then(\n        bibString => new BibLatexParser(bibString, {\n          processUnexpected: true,\n          processUnknown: {\n            collaborator: \"l_name\"\n          }\n        })\n      )\n      .then(\n        parser => parser.output\n      )\n      .then(\n        intermediateJSON => {\n          const exporter = new CSLExporter(intermediateJSON);\n          let cslJSON = exporter.output;\n\n          return Object.keys(cslJSON).map(key =>\n            (intermediateJSON[key] &&\n              intermediateJSON[key][\"unexpected_fields\"] &&\n              intermediateJSON[key][\"unexpected_fields\"][\"file\"])\n              ? Object.assign({}, cslJSON[key], {file: intermediateJSON[key][\"unexpected_fields\"][\"file\"]})\n              : cslJSON[key]\n          );\n        }\n      )\n      .then(\n        json => dispatch(receiveLibrary(json))\n      )\n  }\n}\n*/\n\nexport function fetchLibrary() {\n  return function(dispatch) {\n    dispatch(requestLibrary());\n    return fetch(\"http://localhost:5000/api/library\")\n      .then(\n        response => response.json(),\n        error => {\n          throw new Error(\"Failed to receive library\" + error)\n        }\n      )\n      .then(\n        json => dispatch(receiveLibrary(json)),\n        error => {\n          throw new Error(\"Failed to receive library\" + error)\n        }\n      )\n      .catch(\n        error => {\n          console.log(\"Error fetching library\", error);\n          dispatch(failReceiveLibrary())\n        }\n      )\n  }\n}\n\nexport const saveLibrary = () => {\n  return (dispatch, getState) => {\n    const { references } = getState();\n\n    const blob = new Blob([JSON.stringify(references, null, 2)], {type: \"application/json\"});\n    FileSaver.saveAs(blob, \"MyLibrary.json\");\n\n    dispatch({\n      type: \"SAVE_REFERENCES\"\n    })\n  }\n};\n\n/*\nThe citation.js implementation\n- Currently (OCt-2017), citation.js doesn't read all the fields we need, so abandoning this for now\n\nexport const saveLibrary = () => {\n  return (dispatch, getState) => {\n    const { references } = getState();\n\n    const data = new Cite(references, {\n            forceType: \"array/csl\"\n          });\n\n    const output = data.get({\n      type: 'string',\n      style: 'bibtex'\n    });\n\n\n\n    dispatch({\n      type: \"SAVE_REFERENCES\",\n      data: output\n    })\n  }\n};*/\n/*\nexport function fetchLibrary() {\n  return function (dispatch) {\n    dispatch(requestLibrary());\n    return fetch(\"./library/MyLibrary.bib\")\n      .then(\n        response => response.text(),\n        error => console.log(\"Error fetching library\", error)\n      )\n      .then(\n        bibString => new BibLatexParser(bibString, {\n          processUnexpected: true,\n          processUnknown: {\n            collaborator: \"l_name\"\n          }\n        })\n      )\n      .then(\n        parser => parser.output\n      )\n      .then(\n        intermediateJSON => {\n          const exporter = new CSLExporter(intermediateJSON);\n          let cslJSON = exporter.output;\n\n          return Object.keys(cslJSON).map(key =>\n            (intermediateJSON[key] &&\n              intermediateJSON[key][\"unexpected_fields\"] &&\n              intermediateJSON[key][\"unexpected_fields\"][\"file\"])\n              ? Object.assign({}, cslJSON[key], {file: intermediateJSON[key][\"unexpected_fields\"][\"file\"]})\n              : cslJSON[key]\n          );\n        }\n      )\n      .then(\n        json => dispatch(receiveLibrary(json))\n      )\n  }\n}\n*/\n\nexport const importBibLaTeX = (biblatex) => {\n  return function (dispatch, getState) {\n    new Promise((resolve) => {\n        resolve(biblatex)\n      }\n    )\n      .then(\n        bibString => new BibLatexParser(bibString, {\n          processUnexpected: true,\n          processUnknown: {\n            collaborator: \"l_name\"\n          }\n        })\n      )\n      .then(\n        parser => parser.output\n      )\n      .then(\n        intermediateJSON => {\n          const exporter = new CSLExporter(intermediateJSON);\n          let cslJSON = exporter.output;\n\n          return Object.keys(cslJSON).map(key =>\n            Object.assign({}, cslJSON[key],\n              (intermediateJSON[key] &&\n                intermediateJSON[key][\"unexpected_fields\"] &&\n                intermediateJSON[key][\"unexpected_fields\"][\"file\"])\n                ? {file: intermediateJSON[key][\"unexpected_fields\"][\"file\"]}\n                : {},\n              (intermediateJSON[key][\"entry_key\"])\n                ? {id: intermediateJSON[key][\"entry_key\"]}\n                : {}\n            )\n          );\n        }\n      )\n      .then(\n        json => {\n          const tryToAdd = (currentList, newItem) => {\n            if(currentList.map((i) => i.id === newItem.id).reduce((v, p) => v || p, false)) {\n              return tryToAdd(currentList, Object.assign({}, newItem, {id: newItem[\"id\"] + \"1\"}));\n            }\n            return Object.assign({}, newItem);\n          };\n\n          for(let r of json) {\n            let { references } = getState();\n            let newRef = tryToAdd(references, r);\n            dispatch(updateReference(newRef.id, newRef))\n          }\n        }\n      )\n  }\n};\n\nexport function showCitation(id) {\n  return {\n    type: \"SHOW_CITATION\",\n    id\n  }\n}\n\nexport function dismissCitation() {\n  return {\n    type: \"DISMISS_CITATION\"\n  }\n}\n\nexport function fetchCitationLocale() {\n  return function(dispatch) {\n    dispatch(requestCitationLocale());\n    return fetch(\"http://localhost:5000/api/csl-locales/locales-en-US\")\n      .then(\n        response => response.text(),\n        error => {\n          throw new Error(\"Error fetching CSL locale\" + error)\n        }\n      )\n      .then(\n        xml => dispatch(receiveCitationLocale(xml)),\n        error => {\n          throw new Error(\"Error fetching CSL locale\" + error)\n        }\n      )\n      .catch(\n        error => {\n          console.log(\"Error fetching CSL locale\" + error)\n          dispatch(failReceiveCitationLocale())\n        }\n      )\n  }\n}\n\nexport const failReceiveCitationLocale = () => {\n  return {\n    type: \"FAIL_RECEIVE_CITATION_LOCALE\"\n  }\n};\n\nexport const requestCitationLocale = () => {\n  return {\n    type: \"REQUEST_CITATION_LOCALE\"\n  }\n};\n\nexport const receiveCitationLocale = (xml) => {\n  return {\n    type: \"RECEIVE_CITATION_LOCALE\",\n    xml\n  }\n};\n\nexport function fetchCitationStyleList() {\n  return function(dispatch) {\n    return fetch(\"http://localhost:5000/api/csl-styles\")\n      .then(\n        response => response.json(),\n        error => {\n          throw new Error(\"Error fetching citation style list\" + error)\n        }\n      )\n      .then(\n        styleList => dispatch(receiveCitationStyleList(styleList)),\n        error => {\n          throw new Error(\"Error fetching citation style list\" + error)\n        }\n      )\n      .catch(\n        error => {\n          console.log(\"Error fetching citation style list\", error);\n          dispatch(failReceiveCitationStyleList())\n        }\n      )\n  }\n}\n\nexport function failReceiveCitationStyleList() {\n  return {\n    type: \"FAIL_RECEIVE_CITATION_STYLE_LIST\"\n  }\n}\n\nexport function receiveCitationStyleList(styleList) {\n  return {\n    type: \"RECEIVE_CITATION_STYLE_LIST\",\n    styleList\n  }\n}\n\nexport function fetchCitationStyle(styleName) {\n  return function(dispatch) {\n    dispatch(requestCitationStyle());\n    return fetch(\"http://localhost:5000/api/csl-styles/\" + styleName)\n      .then(\n        response => response.text(),\n        error => {\n          throw new Error(\"Error fetching citation style\" + error)\n        }\n      )\n      .then(\n        xml => dispatch(receiveCitationStyle(xml, styleName)),\n        error => {\n          throw new Error(\"Error fetching citation style\" + error)\n        }\n      )\n      .catch(\n        error => {\n          console.log(\"Failed to receive citation style\", error);\n          dispatch(failReceiveCitationStyle())\n        }\n      )\n  }\n}\n\nexport const failReceiveCitationStyle = () => {\n  return {\n    type: \"FAIL_RECEIVE_CITATION_STYLE\"\n  }\n};\n\nexport const requestCitationStyle = () => {\n  return {\n    type: \"REQUEST_CITATION_STYLE\"\n  }\n};\n\nexport const receiveCitationStyle = (xml, styleName) => {\n  return {\n    type: \"RECEIVE_CITATION_STYLE\",\n    xml,\n    styleName\n  }\n};\n\nexport const getFilePathRoot = () => {\n  return function(dispatch) {\n    return fetch(\"http://localhost:5000/api/filepath\")\n      .then(\n        response => response.text()\n      )\n      .then(\n        path => dispatch(receiveFilePathRoot(path))\n      )\n  }\n};\n\nexport const receiveFilePathRoot = (path) => {\n  return {\n    type: \"RECEIVE_FILE_PATH_ROOT\",\n    path\n  }\n};\n","// Copyright (C) 2017, Stefan Kloppenborg\n//\n// This program is free software: you can redistribute it and/or modify\n// it under the terms of the GNU Affero General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU Affero General Public License for more details.\n//\n// You should have received a copy of the GNU Affero General Public License\n// along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nimport React from 'react'\nimport PropTypes from 'prop-types'\nimport { connect } from 'react-redux'\nimport { dismissCitation, fetchCitationStyle } from \"../actions/index\";\nimport Modal from 'react-modal';\nimport Select from 'react-select';\nimport 'react-select/dist/react-select.css';\n\nconst CSL = require(\"citeproc\");\n\nconst customStyles = {\n  content : {\n    top                   : '50%',\n    left                  : '50%',\n    right                 : 'auto',\n    bottom                : 'auto',\n    marginRight           : '-50%',\n    transform             : 'translate(-50%, -50%)',\n    height                : '300px'\n  }\n};\n\nconst citationContents = (references, citation) => {\n  if(citation === undefined ||\n    citation.refID === undefined ||\n    citation.refID === \"\") {\n    return (<span>No reference specified</span>)\n  }\n\n  if(citation.isFetchingLocale) {\n    return (<span>Fetching Citation Locale, please wait...</span>)\n  }\n\n  if(citation.isFetchingStyle) {\n    return (<span>Fetching Citation Style, please wait...</span>)\n  }\n\n  let ref = references.filter((r) => r.id === citation.refID );\n  if(ref.length < 1) {\n    return (<span>Reference not found</span>)\n  }\n\n  const citeprocSys = {\n    retrieveLocale: (lang) => citation.citationLocale,\n    retrieveItem: (id) => references.filter((r) => r.id === id )[0]\n  };\n\n  const citeproc = new CSL.Engine(citeprocSys, citation.citationStyle);\n  const itemIDs = [];\n  itemIDs.push(citation.refID);\n  citeproc.updateItems(itemIDs);\n  const bibEntry = citeproc.makeBibliography();\n\n  return (<span dangerouslySetInnerHTML={{__html: bibEntry[1]}} />)\n};\n\nlet CitationModal = ({ references, citation, dispatch }) => (\n  <Modal\n    isOpen={citation.isVisible}\n    onAfterOpen={() => {\n    }}\n    onRequestClose={() => {\n      dispatch(dismissCitation());\n    }}\n    style={customStyles}\n    contentLabel=\"Citation\"\n  >\n    <div>\n      <span>\n        {\n          citation.hasFailedCitation\n            ? (<div className=\"Error\">Failed to retrieve citation style.</div>)\n            : (<div/>)\n        }\n      </span>\n      <span>\n        {\n          citation.hasFailedCitationStyleList\n            ? (<div className=\"Error\">Failed to retreive citation style list.</div>)\n            : (<div/>)\n        }\n      </span>\n      <Select\n        name=\"cslStyle\"\n        value={citation.citationStyleName}\n        options={citation.citationStyleList.map(s => ({ value: s, label: s }))}\n        onChange={val => dispatch(fetchCitationStyle(val[\"value\"]))}\n      />\n    </div>\n    <div>{ citationContents(references, citation) }</div>\n  </Modal>\n);\n\nCitationModal.propTypes = {\n  citation: PropTypes.shape({\n    isVisible: PropTypes.bool.isRequired,\n    refID: PropTypes.string.isRequired,\n    citationLocale: PropTypes.string,\n    citationStyle: PropTypes.string\n  })\n};\n\nconst mapStateToProps = state => {\n  return {\n    references: state.references,\n    citation: state.citation\n  }\n};\n\nCitationModal = connect(\n  mapStateToProps\n)(CitationModal);\n\nexport default CitationModal\n","// Copyright (C) 2017, Stefan Kloppenborg\n//\n// This program is free software: you can redistribute it and/or modify\n// it under the terms of the GNU Affero General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU Affero General Public License for more details.\n//\n// You should have received a copy of the GNU Affero General Public License\n// along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nexport const referenceFields = [\n  {\n    field: \"id\",\n    hint: \"the identification of the reference (not part of CSL)\"\n  },\n  {\n    field: \"type\", type: \"TYPE\",\n    hint: \"the type of the reference (ie. article, book, etc.)\"\n  },\n  {\n    field: \"number\",\n    hint: \"number identifying the item (e.g. a report number)\"\n  },\n  {\n    field: \"author\", type: \"NAME\",\n    hint: \"author\"\n  },\n  {\n    field: \"composer\", type: \"NAME\",\n    hint: \"composer (e.g. of a musical score)\"\n  },\n  {\n    field: \"director\", type: \"NAME\",\n    hint: \"director (e.g. of a film)\"\n  },\n  {\n    field: \"editor\", type: \"NAME\",\n    hint: \"editor\"\n  },\n  {\n    field: \"editorial-director\", type: \"NAME\",\n    hint: \"managing editor (“Directeur de la Publication” in French)\"\n  },\n  {\n    field: \"illustrator\", type: \"NAME\",\n    hint: \"illustrator (e.g. of a children’s book)\"\n  },\n  {\n    field: \"interviewer\", type: \"NAME\",\n    hint: \"interviewer (e.g. of an interview)\"\n  },\n  {\n    field: \"recipient\", type: \"NAME\",\n    hint: \"recipient (e.g. of a letter)\"\n  },\n  {\n    field: \"translator\", type: \"NAME\",\n    hint: \"translator\"\n  },\n  {\n    field: \"title\",\n    hint: \"primary title of the item\"\n  },\n  {\n    field: \"title-short\",\n    hint: \"short/abbreviated form of “title” (also accessible through the “short” form of the “title” variable)\"\n  },\n  {\n    field: \"edition\",\n    hint: \"(container) edition holding the item (e.g. “3” when citing a chapter in the third edition of a book)\"\n  },\n  {\n    field: \"abstract\", type: 'TEXT_AREA',\n    hint: \"abstract of the item (e.g. the abstract of a journal article)\"\n  },\n  {\n    field: \"annote\",\n    hint: \"reader’s notes about the item content\"\n  },\n  {\n    field: \"note\",\n    hint: \"(short) inline note giving additional item details (e.g. a concise summary or commentary)\"\n  },\n  {\n    field: \"container-author\", type: \"NAME\",\n    hint: \"author of the container holding the item (e.g. the book author for a book chapter)\"\n  },\n  {\n    field: \"container-title\",\n    hint: \"title of the container holding the item \" +\n    \"(e.g. the book title for a book chapter, the journal title for a journal article)\"\n  },\n  {\n    field: \"container-title-short\",\n    hint: \"short/abbreviated form of “container-title” \" +\n    \"(also accessible through the “short” form of the “container-title” variable)\"\n  },\n  {\n    field: \"container\", type: \"DATE\",\n    hint: \"?\"\n  },\n  {\n    field: \"volume\",\n    hint: \"(container) volume holding the item (e.g. “2” when citing a chapter from book volume 2)\"\n  },\n  {\n    field: \"issue\",\n    hint: \"(container) issue holding the item (e.g. “5” when citing a journal article from journal volume 2, issue 5)\"\n  },\n  {\n    field: \"section\",\n    hint: \"container section holding the item (e.g. “politics” for a newspaper article)\"\n  },\n  {\n    field: \"page\",\n    hint: \"range of pages the item (e.g. a journal article) covers in a container (e.g. a journal issue)\"\n  },\n  {\n    field: \"page-first\",\n    hint: \"first page of the range of pages the item (e.g. a journal article) covers in a container \" +\n    \"(e.g. a journal issue)\"\n  },\n  {\n    field: \"publisher\",\n    hint: \"publisher\"\n  },\n  {\n    field: \"publisher-place\",\n    hint: \"geographic location of the publisher\"\n  },\n  {\n    field: \"issued\", type: \"DATE\",\n    hint: \"date the item was issued/published\"\n  },\n  {\n    field: \"submitted\", type: \"DATE\",\n    hint: \"date the item (e.g. a manuscript) has been submitted for publication\"\n  },\n  {\n    field: \"chapter-number\",\n    hint: \"chapter number\"\n  },\n  {\n    field: \"collection-editor\", type: \"NAME\",\n    hint: \"editor of the collection holding the item (e.g. the series editor for a book)\"\n  },\n  {\n    field: \"collection-title\",\n    hint: \"title of the collection holding the item (e.g. the series title for a book)\"\n  },\n  {\n    field: \"collection-number\",\n    hint: \"number identifying the collection holding the item (e.g. the series number for a book)\"\n  },\n  {\n    field: \"accessed\", type: \"DATE\",\n    hint: \"date the item has been accessed\"\n  },\n  {\n    field: \"event\",\n    hint: \"name of the related event (e.g. the conference name when citing a conference paper)\"\n  },\n  {\n    field: \"event-place\",\n    hint: \"geographic location of the related event (e.g. “Amsterdam, the Netherlands”)\"\n  },\n  {\n    field: \"event-date\", type: \"DATE\",\n    hint: \"date the related event took place\"\n  },\n  {\n    field: \"genre\",\n    hint: \"class, type or genre of the item (e.g. “adventure” for an adventure movie, \" +\n    \"“PhD dissertation” for a PhD thesis)\"\n  },\n  {\n    field: \"authority\",\n    hint: \"issuing or judicial authority (e.g. “USPTO” for a patent, “Fairfax Circuit Court” for a legal case)\"\n  },\n  {\n    field: \"jurisdiction\",\n    hint: \"geographic scope of relevance (e.g. “US” for a US patent)\"\n  },\n  {\n    field: \"original-author\", type: \"NAME\",\n    hint: \"?\"\n  },\n  {\n    field: \"original-title\",\n    hint: \"title of the original version (e.g. “Война и мир”, the untranslated Russian title of “War and Peace”)\"\n  },\n  {\n    field: \"original-date\", type: \"DATE\",\n    hint: \"(issue) date of the original version\"\n  },\n  {\n    field: \"original-publisher\",\n    hint: \"original publisher, for items that have been republished by a different publisher\"\n  },\n  {\n    field: \"original-publisher-place\",\n    hint: \"geographic location of the original publisher (e.g. “London, UK”)\"\n  },\n  {\n    field: \"references\",\n    hint: \"resources related to the procedural history of a legal case\"\n  },\n  {\n    field: \"status\",\n    hint: \"publication) status of the item (e.g. “forthcoming”)\"\n  },\n  {\n    field: \"version\",\n    hint: \"version of the item (e.g. “2.0.9” for a software program)\"\n  },\n  {\n    field: \"number-of-pages\",\n    hint: \"total number of pages of the cited item\"\n  },\n  {\n    field: \"number-of-volumes\",\n    hint: \"total number of volumes, usable for citing multi-volume books and such\"\n  },\n  {\n    field: \"reviewed-author\", type: \"NAME\",\n    hint: \"author of the item reviewed by the current item\"\n  },\n  {\n    field: \"reviewed-title\",\n    hint: \"title of the item reviewed by the current item\"\n  },\n  {\n    field: \"scale\",\n    hint: \"scale of e.g. a map\"\n  },\n  {\n    field: \"dimensions\",\n    hint: \"physical (e.g. size) or temporal (e.g. running time) dimensions of the item\"\n  },\n  {\n    field: \"archive\",\n    hint: \"archive storing the item\"\n  },\n  {\n    field: \"archive_location\",\n    hint: \"storage location within an archive (e.g. a box and folder number)\"\n  },\n  {\n    field: \"archive-place\",\n    hint: \"geographic location of the archive\"\n  },\n  {\n    field: \"source\",\n    hint: \"from whence the item originates (e.g. a library catalog or database)\"\n  },\n  {\n    field: \"locator\",\n    hint: \"a cite-specific pinpointer within the item (e.g. a page number within a book, or a volume in a \" +\n    \"multi-volume work). Must be accompanied in the input data by a label indicating the locator type (see the \" +\n    \"Locators term list), which determines which term is rendered by cs:label when the “locator” variable is \" +\n    \"selected.\"\n  },\n  {\n    field: \"DOI\",\n    hint: \"Digital Object Identifier (e.g. “10.1128/AEM.02591-07”)\"\n  },\n  {\n    field: \"ISBN\",\n    hint: \"International Standard Book Number\"\n  },\n  {\n    field: \"ISSN\",\n    hint: \"International Standard Serial Number\"\n  },\n  {\n    field: \"PMCID\",\n    hint: \"PubMed Central reference number\"\n  },\n  {\n    field: \"PMID\",\n    hint: \"PubMed reference number\"\n  },\n  {\n    field: \"call-number\",\n    hint: \"call number (to locate the item in a library)\"\n  },\n  {\n    field: \"keyword\",\n    hint: \"keyword(s) or tag(s) attached to the item\"\n  },\n  {\n    field: \"medium\",\n    hint: \"medium description (e.g. “CD”, “DVD”, etc.)\"\n  },\n  {\n    field: \"URL\",\n    hint: \"Uniform Resource Locator (e.g. “http://aem.asm.org/cgi/content/full/74/9/2766”)\"\n  },\n  {\n    field: \"file\",\n    type: \"FILE\",\n    hint: \"the file linked with this reference entity\"\n  },\n];\n\nexport default referenceFields;\n","// Copyright (C) 2017, Stefan Kloppenborg\n//\n// This program is free software: you can redistribute it and/or modify\n// it under the terms of the GNU Affero General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU Affero General Public License for more details.\n//\n// You should have received a copy of the GNU Affero General Public License\n// along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nimport React from 'react'\nimport PropTypes from 'prop-types'\n\nclass Editable extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      isEditing: false\n    }\n  }\n\n  checkEnter(e) {\n    if(e.key === 'Enter' && !this.props.isTextArea) {\n      this.save()\n    } else if(e.key === 'Escape') {\n      this.cancel()\n    }\n  }\n\n  edit() {\n    this.setState({\n      editing: true\n    })\n  }\n\n  save() {\n    let val = this.refs.newText.value;\n    this.setState({\n      editing: false\n    });\n    if(this.props.onEdit) {\n      this.props.onEdit(this.props.field, val);\n    }\n  }\n\n  cancel() {\n    this.setState({\n      editing: false\n    })\n  }\n\n  renderNormal() {\n    return (\n      <span onClick={() => { this.edit() }}>\n        {!this.props.value || this.props.value === \"\" ?\n          (<span className=\"Editable-empty\">{ this.props.field }</span>)\n          : this.props.value.toString().split(\"\\n\").map(\n            (t, index) => (<span key={index} className=\"Editable-paragraph\">{t === \"\" ? (<br/>) : t}</span>)\n          )\n        }\n      </span>\n    )\n  }\n\n  renderForm() {\n    return (\n      <input\n        ref=\"newText\"\n        defaultValue={this.props.value}\n        onBlur={() => { this.save() }}\n        onKeyDown={(e) => { this.checkEnter(e) }}\n        autoFocus={true}\n        className=\"Editable\"\n      />\n    );\n  }\n\n  renderTextArea() {\n    return (\n      <textarea\n        ref=\"newText\"\n        defaultValue={this.props.value}\n        onBlur={() => { this.save() }}\n        onKeyDown={(e) => { this.checkEnter(e) }}\n        autoFocus={true}\n        className=\"Editable\"\n      />\n    );\n  }\n\n  render() {\n    if (this.state.editing && this.props.isTextArea) {\n      return this.renderTextArea()\n    } else if(this.state.editing) {\n      return this.renderForm()\n    } else {\n      return this.renderNormal()\n    }\n  }\n}\n\nEditable.propTypes = {\n  field: PropTypes.string.isRequired,\n  value: PropTypes.string.isRequired,\n  onEdit: PropTypes.func.isRequired,\n  isTextArea: PropTypes.bool\n};\n\nexport default Editable;\n","// Copyright (C) 2017, Stefan Kloppenborg\n//\n// This program is free software: you can redistribute it and/or modify\n// it under the terms of the GNU Affero General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU Affero General Public License for more details.\n//\n// You should have received a copy of the GNU Affero General Public License\n// along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nimport React from 'react'\nimport PropTypes from 'prop-types'\n\nclass DateEdit extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      isEditing: false,\n      yyyy: this.get_date_part_from_props(this.props.value, 0),\n      mm: this.get_date_part_from_props(this.props.value, 1),\n      dd: this.get_date_part_from_props(this.props.value, 2)\n    }\n  }\n\n  get_date_part_from_props(value, part) {\n    if(!value || !value[\"date-parts\"] || !value[\"date-parts\"][0]) {\n      return \"\"\n    }\n    return value[\"date-parts\"][0][part];\n  }\n\n  renderNormal() {\n    if (!this.props.value || !this.props.value[\"date-parts\"]) {\n      return (\n        <span\n          className=\"Editable-empty\"\n          onClick={() => { this.setState({isEditing: true}) }}\n        >\n          yyyy/mm/dd\n        </span>\n      )\n    }\n    const date_parts = this.props.value[\"date-parts\"][0];\n    return (\n      <span\n        onClick={() => { this.setState({isEditing: true}) }}\n      >\n        {\n          [\n            !!date_parts[0] ? date_parts[0] : \"\",\n            !!date_parts[1] ? date_parts[1] : \"\",\n            !!date_parts[2] ? date_parts[2] : \"\"\n          ].filter(dp => dp !== \"\").join(\"/\")\n        }\n      </span>\n    )\n  }\n\n  componentWillUnmount() {\n\t\tclearTimeout(this.focusBlurTimeout);\n\t}\n\n  onBlurTimerHandler() {\n    let result = {};\n\n    if(!!this.state.yyyy && this.state.yyyy !== \"\") {\n      result[\"date-parts\"] = result[\"date-parts\"] ? result[\"date-parts\"] : [];\n      result[\"date-parts\"][0] = result[\"date-parts\"][0] ? result[\"date-parts\"][0] : [];\n      result[\"date-parts\"][0][0] = this.state.yyyy;\n    }\n\n    if(!!this.state.mm && this.state.mm !== \"\") {\n      result[\"date-parts\"] = result[\"date-parts\"] ? result[\"date-parts\"] : [];\n      result[\"date-parts\"][0] = result[\"date-parts\"][0] ? result[\"date-parts\"][0] : [];\n      result[\"date-parts\"][0][0] = result[\"date-parts\"][0][0] && result[\"date-parts\"][0][0] !== \"\"\n        ? result[\"date-parts\"][0][0] : \"1\";\n      result[\"date-parts\"][0][1] = this.state.mm;\n    }\n\n    if(!!this.state.dd && this.state.dd !== \"\") {\n      result[\"date-parts\"] = result[\"date-parts\"] ? result[\"date-parts\"] : [];\n      result[\"date-parts\"][0] = result[\"date-parts\"][0] ? result[\"date-parts\"][0] : [];\n      result[\"date-parts\"][0][0] = result[\"date-parts\"][0][0] && result[\"date-parts\"][0][0] !== \"\"\n        ? result[\"date-parts\"][0][0] : \"1\";\n      result[\"date-parts\"][0][1] = result[\"date-parts\"][0][1] && result[\"date-parts\"][0][1] !== \"\"\n        ? result[\"date-parts\"][0][1] : \"1\";\n      result[\"date-parts\"][0][2] = this.state.dd;\n    }\n\n    if(this.props.onEdit) {\n      this.props.onEdit(this.props.field, result)\n    }\n\n    this.setState({\n      isEditing: false,\n      yyyy: this.get_date_part_from_props(result, 0),\n      mm: this.get_date_part_from_props(result, 1),\n      dd: this.get_date_part_from_props(result, 2)\n    });\n  }\n\n  onBlur(event) {\n    event.persist();\n    clearTimeout(this.focusBlurTimeout);\n    this.focusBlurTimeout = setTimeout(() => this.onBlurTimerHandler(), 16);\n  }\n\n  onFocus() {\n    clearTimeout(this.focusBlurTimeout);\n    this.focusBlurTimeout = setTimeout(() => {\n      this.setState({\n        isEditing: true,\n      });\n    }, 16);\n  }\n\n  renderForm() {\n    return (\n      <span>\n        <input\n          type=\"text\"\n          className=\"DateEdit-yyyy\"\n          name=\"yyyy\"\n          value={this.state.yyyy}\n          onBlur={e => this.onBlur(e)}\n          onFocus={e => this.onFocus(e)}\n          onChange={v => {\n            this.setState({yyyy: v.target.value})\n          }}\n          autoFocus=\"true\"\n        />\n        <input\n          type=\"text\"\n          className=\"DateEdit-xx\"\n          name=\"mm\"\n          value={this.state.mm}\n          onBlur={e => this.onBlur(e)}\n          onFocus={e => this.onFocus(e)}\n          onChange={v => {\n            this.setState({mm: v.target.value})\n          }}\n        />\n        <input\n          type=\"text\"\n          className=\"DateEdit-xx\"\n          name=\"dd\"\n          value={this.state.dd}\n          onBlur={e => this.onBlur(e)}\n          onFocus={e => this.onFocus(e)}\n          onChange={v => {\n            this.setState({dd: v.target.value})\n          }}\n        />\n      </span>\n    )\n  }\n\n  render() {\n    return this.state.isEditing\n      ? this.renderForm()\n      : this.renderNormal()\n  }\n}\n\nDateEdit.propTypes = {\n  field: PropTypes.string.isRequired,\n  value: PropTypes.string.isRequired,\n  onEdit: PropTypes.func.isRequired\n};\n\nexport default DateEdit;\n","// Copyright (C) 2017, Stefan Kloppenborg\n//\n// This program is free software: you can redistribute it and/or modify\n// it under the terms of the GNU Affero General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU Affero General Public License for more details.\n//\n// You should have received a copy of the GNU Affero General Public License\n// along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nexport const nameSubFields = [\n  \"given\",\n  \"dropping-particle\",\n  \"non-dropping-particle\",\n  \"family\",\n  \"literal\"\n];\n","// Copyright (C) 2017, Stefan Kloppenborg\n//\n// This program is free software: you can redistribute it and/or modify\n// it under the terms of the GNU Affero General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU Affero General Public License for more details.\n//\n// You should have received a copy of the GNU Affero General Public License\n// along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nimport React from 'react'\nimport PropTypes from 'prop-types'\nimport {connect} from 'react-redux'\nimport Editable from \"./Editable\";\nimport { nameSubFields } from '../common/nameSubFields'\n\nclass EditableNameList extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {}\n  }\n\n  render() {\n    return (\n      <div>\n        {!!this.props.nameList\n          ?this.props.nameList.map((a, index) => (\n              <div key={index} className=\"Name-list-row\">\n                <div className=\"Name-editable-left\">\n                  {nameSubFields.map((f) => (\n                    <div key={f} className=\"Name-field\">\n                      <Editable field={f}\n                                value={a[f]}\n                                onEdit={(subField, value) => {\n                                  this.props.onEditNameField(index, subField, value)\n                                }}\n                      />\n                    </div>\n                  ))}\n\n                </div>\n                <div className=\"Name-editable-right\">\n                  <button\n                    type=\"button\"\n                    onClick={() => {\n                      this.props.onDeleteName(index)\n                    }}\n                  >X\n                  </button>\n                </div>\n\n              </div>\n            )\n          )\n          : (<span/>)\n        }\n        <button\n          type=\"button\"\n          onClick={() => this.props.onAddName()}\n        >+</button>\n      </div>\n    );\n  }\n}\n\nEditableNameList.propTypes = {\n  nameList: PropTypes.arrayOf(\n    PropTypes.shape({\n      family: PropTypes.string,\n      given: PropTypes.string,\n      'non-dropping-particle': PropTypes.string,\n      'dropping-particle': PropTypes.string,\n      suffix: PropTypes.string,\n      literal: PropTypes.string\n    })),\n  onEditNameField: PropTypes.func.isRequired,\n  onDeleteName: PropTypes.func.isRequired,\n  onAddName: PropTypes.func.isRequired\n};\n\n\nexport default connect()(EditableNameList)\n","// Copyright (C) 2017, Stefan Kloppenborg\n//\n// This program is free software: you can redistribute it and/or modify\n// it under the terms of the GNU Affero General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU Affero General Public License for more details.\n//\n// You should have received a copy of the GNU Affero General Public License\n// along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nimport React from 'react'\nimport PropTypes from 'prop-types'\nimport Editable from \"./Editable\";\nimport Modal from 'react-modal';\nimport Select from 'react-select';\nimport 'react-select/dist/react-select.css';\n\nconst customStyles = {\n  content : {\n    top                   : '50%',\n    left                  : '50%',\n    right                 : 'auto',\n    bottom                : 'auto',\n    marginRight           : '-50%',\n    transform             : 'translate(-50%, -50%)',\n    height                : '300px',\n    width                 : '350px'\n  }\n};\n\nclass FileList extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      isShowingFilePickerModal: false,\n      fileToAdd: \"\"\n    };\n  }\n\n  closeModal() {\n    this.setState({\n      ...this.state,\n      isShowingFilePickerModal: false\n    })\n  }\n\n  openModal() {\n    this.setState({\n      ...this.state,\n      isShowingFilePickerModal: true,\n      fileToAdd: \"\"\n    })\n  }\n\n  fileLink(fileText, index) {\n    let fileHREF = \"\";\n    const fileObj = fileText.split(\":\");\n    if(fileObj.length === 3) {\n      fileHREF = this.props.hrefRoot + \"/\" + fileObj[1];\n    } else {\n      fileHREF = fileObj[0];\n    }\n\n    return (<a key={index} href={fileHREF} target=\"_blank\" rel=\"noopener noreferrer\">Open File<br/></a>)\n  }\n\n  render() {\n    const fileList = !!this.props.files ? this.props.files.split(\";\") : [];\n\n    return (\n      <div>\n        {!!fileList\n          ? fileList.map((f, index) => (\n              <div key={index} className=\"Name-list-row\">\n                <div className=\"Name-editable-left\">\n                  <Editable field=\"file\"\n                            value={f}\n                            onEdit={(field, value) => {\n                              this.props.onEditFileField(index, value)\n                            }}\n                  />\n                  <div className=\"Name-editable-left-link\">{this.fileLink(f, index)}</div>\n                </div>\n                <div className=\"Name-editable-right\">\n                  <button\n                    type=\"button\"\n                    onClick={() => {\n                      this.props.onDeleteFile(index)\n                    }}\n                  >X\n                  </button>\n                </div>\n              </div>\n            )\n          )\n          : (<span/>)\n        }\n        <button\n          type=\"button\"\n          onClick={() => this.openModal()}\n        >Add File\n        </button>\n        <Modal\n          isOpen={this.state.isShowingFilePickerModal}\n          onAfterOpen={() => {}}\n          onRequestClose={() => {\n            this.setState({\n              ...this.state,\n              isShowingFilePickerModal: false\n            })}}\n          style={customStyles}\n          contentLabel=\"Add File\"\n        >\n          <div>Select file to add:</div>\n          <Select\n            name=\"filePicker\"\n            value={this.state.fileToAdd}\n            options={\n              this.props.allowableFileList\n                .map(f =>\n                  ({value: [f[\"file_name\"], f[\"path\"], f[\"mime_type\"]].join(\":\"), label: f[\"path\"]}))\n                .filter(f => (!this.props.files || this.props.files.split(\";\")\n                  .filter(curF => f.value === curF)\n                  .length === 0\n                ))\n            }\n            onChange={val => {\n              this.setState({\n                ...this.state,\n                fileToAdd: !!val ? val.value : \"\"\n              })\n            }}\n          />\n          <div>\n            <button\n              type=\"button\"\n              onClick={() => {\n                const fileToAdd = this.state.fileToAdd;\n                if(fileToAdd === \"\") {\n                  return\n                }\n\n                this.props.onAddFile(fileToAdd);\n\n                this.closeModal()\n              }}\n            >Add</button>\n            <button\n              type=\"button\"\n              onClick={() => this.closeModal()}\n            >Cancel</button>\n          </div>\n        </Modal>\n      </div>\n    )\n  }\n}\n\nFileList.propTypes = {\n  files: PropTypes.string.isRequired,\n  onEditFileField: PropTypes.func.isRequired,\n  onDeleteFile: PropTypes.func.isRequired,\n  onAddFile: PropTypes.func.isRequired,\n  allowableFileList: PropTypes.array.isRequired,\n  hrefRoot: PropTypes.string.isRequired\n};\n\nexport default FileList\n","// Copyright (C) 2017, Stefan Kloppenborg\n//\n// This program is free software: you can redistribute it and/or modify\n// it under the terms of the GNU Affero General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU Affero General Public License for more details.\n//\n// You should have received a copy of the GNU Affero General Public License\n// along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nimport React from 'react'\nimport PropTypes from 'prop-types'\nimport { connect } from 'react-redux'\nimport {\n  saveEditScreen,\n  dismissEditScreen,\n  editReferenceField,\n  editNameField,\n  addName,\n  removeName,\n  IDErrorEditScreen,\n  editFileField,\n  removeFile,\n  addFile\n} from \"../actions/index\";\nimport ReactConfirmAlert, { confirmAlert } from 'react-confirm-alert';\nimport 'react-confirm-alert/src/react-confirm-alert.css'\nimport referenceFields from \"../common/referenceFields\";\nimport Editable from \"./Editable\"\nimport DateEdit from \"./DateEdit\"\nimport EditableNameList from \"./EditableNameList\"\nimport FileList from \"./FileList\"\nimport Select from 'react-select';\nimport 'react-select/dist/react-select.css';\nimport ReactTooltip from 'react-tooltip'\n\nconst refFields = referenceFields;\n\nconst allowableTypes = [\n  \"article\",\n  \"article-magazine\",\n  \"article-newspaper\",\n  \"article-journal\",\n  \"bill\",\n  \"book\",\n  \"broadcast\",\n  \"chapter\",\n  \"dataset\",\n  \"entry\",\n  \"entry-dictionary\",\n  \"entry-encyclopedia\",\n  \"figure\",\n  \"graphic\",\n  \"interview\",\n  \"legislation\",\n  \"legal_case\",\n  \"manuscript\",\n  \"map\",\n  \"motion_picture\",\n  \"musical_score\",\n  \"pamphlet\",\n  \"paper-conference\",\n  \"patent\",\n  \"post\",\n  \"post-weblog\",\n  \"personal_communication\",\n  \"report\",\n  \"review\",\n  \"review-book\",\n  \"song\",\n  \"speech\",\n  \"thesis\",\n  \"treaty\",\n  \"webpage\"\n];\n\nconst confirmCancel = (dispatch) => {\n  confirmAlert({\n    title: \"Edit Reference\",\n    message: \"Are you sure you want to close without saving?\",\n    confirmLabel: \"Close without saving\",\n    cancelLabel: \"Continue editing\",\n    onConfirm: () => { dispatch(dismissEditScreen()) },\n    onCancel: () => { /* Do nothing on cancel, just let alert go away */}\n  })\n};\n\nconst IDError = (dispatch) => (\n  <ReactConfirmAlert\n    title=\"Edit Reference\"\n    message=\"You have entered an invalid ID or one that is assigned to another item. Please change it.\"\n    confirmLabel=\"OK\"\n    cancelLabel=\"\"\n    onConfirm={() => { dispatch(IDErrorEditScreen(false)) }}\n    onCancel={() => { /* Do nothing on cancel, just let, alert go away */}}\n  />\n);\n\nconst fieldContents = (editReferenceScreen, reference, library, field, dispatch) => {\n  switch (field.type) {\n    case \"TEXT_AREA\":\n      return (\n        <Editable\n          value={reference[field.field]}\n          field={field.field}\n          isTextArea={true}\n          onEdit={(field, value) => {\n            dispatch(editReferenceField(field, value))\n          }}\n        />\n      );\n    case \"NAME\":\n      return (\n        <EditableNameList\n          field={field.field}\n          nameList={reference[field.field]}\n          isEditable={true}\n          onEditNameField={(index, key, value) => {\n            dispatch(editNameField(field.field, index, key, value))\n          }}\n          onAddName={() => {\n            dispatch(addName(field.field))\n          }}\n          onDeleteName={(index) => {\n            dispatch(removeName(field.field, index))\n          }}\n        />\n      );\n    case \"FILE\":\n      return (\n        <FileList\n          files={reference[field.field]}\n          onEditFileField={(index, value) => {\n            dispatch(editFileField(field.field, index, value))\n          }}\n          onDeleteFile={(index) => {\n            dispatch(removeFile(field.field, index))\n          }}\n          onAddFile={(file) => {\n            dispatch(addFile(field.field, file))\n          }}\n          allowableFileList={editReferenceScreen.fileList}\n          hrefRoot={library.hrefRoot}\n        />\n      );\n    case \"DATE\":\n      return (\n        <DateEdit\n          value={reference[field.field]}\n          field={field.field}\n          onEdit={(field, value) => {\n            dispatch(editReferenceField(field, value))\n          }}\n        />\n      );\n    case \"TYPE\":\n      return (\n        <Select\n            name=\"typePicker\"\n            value={reference[field.field]}\n            options={\n              allowableTypes\n                .map(t =>\n                  ({value: t, label: t}))\n            }\n            onChange={value => {\n              dispatch(editReferenceField(field.field, !!value ? value.value : \"\"))\n            }}\n          />\n      );\n    default:\n      return (\n        <Editable\n          value={reference[field.field]}\n          field={field.field}\n          isTextArea={false}\n          onEdit={(field, value) => {\n            dispatch(editReferenceField(field, value))\n          }}\n        />\n      );\n  }\n};\n\nconst modalContents = (editReferenceScreen, library, dispatch) => {\n  if(!editReferenceScreen || !editReferenceScreen.referenceEditing) {\n    return (<span>No reference specified</span>)\n  }\n\n  return refFields.map(\n    (rf) =>\n      (\n        <div key={rf.field} className=\"Ref-list-item-expand-row\">\n          <div\n            className=\"Ref-list-item-expand-left\"\n            data-tip={rf.hint}\n          >{rf.field}</div>\n          <div className=\"Ref-list-item-expand-right\">\n            { fieldContents(editReferenceScreen, editReferenceScreen.referenceEditing, library, rf, dispatch) }\n          </div>\n        </div>\n      )\n  )\n};\n\nconst mapStateToProps = state => {\n  return {\n    editReferenceScreen: state.editReferenceScreen,\n    library: state.library\n  }\n};\n\nlet EditReferenceScreen = ({editReferenceScreen, library, dispatch}) => (\n  <div>\n    <ReactTooltip />\n    <div className=\"Screen-header\">\n      <div className=\"Header-buttons\">\n        <button type=\"button\"\n                onClick={() => {\n                  dispatch(saveEditScreen())\n                }}\n        >Save</button>\n        <button type=\"button\"\n                onClick={() => {\n                  if(editReferenceScreen.isModified) {\n                    confirmCancel(dispatch)\n                  } else {\n                    dispatch(dismissEditScreen())\n                  }\n                }}\n        >Cancel</button>\n      </div>\n    </div>\n    <span>\n      {\n        editReferenceScreen.hasFailedUpdatedReference\n          ? (<div className=\"Error\">Failed to update reference on server</div>)\n          : (<span/>)\n      }\n    </span>\n    <span>\n      {editReferenceScreen.isShowingIDError\n        ? IDError(dispatch)\n        : <span/>\n      }\n    </span>\n    <div className=\"Ref-list-item\">\n      { modalContents(editReferenceScreen, library, dispatch) }\n    </div>\n  </div>\n);\n\nEditReferenceScreen = connect(\n  mapStateToProps\n)(EditReferenceScreen);\n\nEditReferenceScreen.propTypes = {\n  editReferenceModal: PropTypes.shape({\n    isVisible: PropTypes.bool.isRequired,\n    refID: PropTypes.string.isRequired,\n    isModified: PropTypes.bool.isRequired\n  })\n};\n\nexport default EditReferenceScreen\n","// Copyright (C) 2017, Stefan Kloppenborg\n//\n// This program is free software: you can redistribute it and/or modify\n// it under the terms of the GNU Affero General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU Affero General Public License for more details.\n//\n// You should have received a copy of the GNU Affero General Public License\n// along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nimport React from 'react'\nimport PropTypes from 'prop-types'\nimport { showCitation, showEditScreen } from \"../actions/index\";\nimport { connect } from 'react-redux'\nimport { referenceFields } from \"../common/referenceFields\"\nimport { nameSubFields } from '../common/nameSubFields'\n\n\nclass Reference extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      isExpanded: false\n    }\n  }\n\n  doExpand() {\n    this.setState({\n      isExpanded: !this.state.isExpanded\n    })\n  }\n\n  onCitation() {\n    let { dispatch } = this.props;\n    let action = showCitation(this.props.reference.id);\n    dispatch(action)\n  }\n\n  doEditModal() {\n    let { dispatch } = this.props;\n    let action = showEditScreen(this.props.reference.id);\n    dispatch(action)\n  }\n\n  onShowYAML() {\n    // TODO: Write this\n  }\n\n  show_date(date) {\n    if (!date[\"date-parts\"]) {\n      return (<span>Malformed date</span>);\n    }\n    const date_parts = date[\"date-parts\"][0];\n\n    return [\n      !!date_parts[0] ? date_parts[0] : \"\",\n      !!date_parts[1] ? date_parts[1] : \"\",\n      !!date_parts[2] ? date_parts[2] : \"\"\n    ].filter(dp => dp !== \"\").join(\"/\")\n  }\n\n  show_name_list(nameList, filterRE) {\n    if (!nameList) {\n      return \"\"\n    }\n\n    return nameList.map((a, index) => (\n        <div key={index} className=\"Name-list-row\">\n          <div>\n            {nameSubFields.map((f) => (\n              <div key={f} className=\"Name-field\">\n                {\n                  !!a[f]\n                    ? this.highlighted_text(a[f], filterRE)\n                    : (<span/>)\n                }\n              </div>\n            ))}\n\n          </div>\n        </div>\n      )\n    )\n  }\n\n  field_contents(field, filterRE) {\n    switch (field.type) {\n      case \"NAME\":\n        return (\n          <div key={field.field} className=\"Ref-list-item-expand-row\">\n            <div className=\"Ref-list-item-expand-left\">{field.field}</div>\n            <div className=\"Ref-list-item-expand-right\">\n              {\n                this.show_name_list(\n                  this.props.reference[field.field],\n                  filterRE\n                )\n              }\n            </div>\n          </div>\n        );\n      case \"DATE\":\n        return (\n          <div key={field.field} className=\"Ref-list-item-expand-row\">\n            <div className=\"Ref-list-item-expand-left\">{field.field}</div>\n            <div className=\"Ref-list-item-expand-right\">\n              {\n                this.highlighted_text(\n                  this.show_date(this.props.reference[field.field]),\n                  filterRE\n                )\n              }\n            </div>\n          </div>\n        );\n      case \"FILE\":\n        return (\n          <div key={field.field} className=\"Ref-list-item-expand-row\">\n            <div className=\"Ref-list-item-expand-left\">{field.field}</div>\n            <div className=\"Ref-list-item-expand-right\">\n              {\n                this.props.reference[field.field].split(\";\").map((fileText, index) => {\n                  let fileTitle = \"\";\n                  let fileHREF = \"\";\n                  const fileObj = fileText.split(\":\");\n                  if(fileObj.length === 3) {\n                    fileTitle = fileObj[0];\n                    fileHREF = this.props.hrefRoot + \"/\" + fileObj[1];\n                  } else {\n                    fileTitle = fileObj[0];\n                    fileHREF = fileObj[0];\n                  }\n\n                  return (<a key={index} href={fileHREF} target=\"_blank\" rel=\"noopener noreferrer\">{fileTitle}<br/></a>)\n                })\n              }\n            </div>\n          </div>\n        );\n      default:\n        return (\n          <div key={field.field} className=\"Ref-list-item-expand-row\">\n            <div className=\"Ref-list-item-expand-left\">{field.field}</div>\n            <div className=\"Ref-list-item-expand-right\">\n              {\n                this.highlighted_text(\n                  this.props.reference[field.field],\n                  filterRE\n                )\n              }\n            </div>\n          </div>\n        );\n    }\n  }\n\n  render_expanded(filterRE) {\n    return (\n      <div className=\"Ref-list-item\">\n        {\n          referenceFields.filter((rf) => !!this.props.reference[rf.field])\n            .map( (rf) => this.field_contents(rf, filterRE) )\n        }\n        <div className=\"Ref-list-item-expand-all\">\n          <button type=\"button\" onClick={() => { this.onShowYAML() }}>YAML</button>\n          <button type=\"button\" onClick={() => { this.doEditModal() }}>Edit</button>\n          <button type=\"button\" onClick={() => { this.onCitation() }}>Citation</button>\n          <button type=\"button\" onClick={() => { this.doExpand() }}>Collapse</button>\n        </div>\n      </div>\n    )\n  }\n\n  render_author_list_collapsed() {\n    if(!this.props.reference.author) {\n      return \"\"\n    }\n    return this.props.reference.author.map((author) => {\n      if(author.literal) {\n        return author.literal\n      }\n      if(author.family) {\n        if(author['non-dropping-particle']) {\n          return author['non-dropping-particle'] + \" \" + author.family\n        }\n        return author.family\n      }\n      return \"\"\n    }).join(\", \")\n  }\n\n  render_collapsed(filterRE) {\n    return (\n      <div className=\"Ref-list-item\">\n        <div className=\"Ref-list-item-1\">\n          <span className=\"Ref-list-item-1-row\">\n            {\n              this.highlighted_text(\n                this.render_author_list_collapsed(),\n                filterRE\n              )\n            }\n          </span>\n          <span className=\"Ref-list-item-1-row\">\n            {\n              this.props.reference.number\n                ? this.highlighted_text(\n                  this.props.reference.number,\n                  filterRE\n                )\n                : <span/>\n            }\n          </span>\n        </div>\n        <div className=\"Ref-list-item-2\">\n          {\n            this.highlighted_text(\n              (this.props.reference.issued && !!this.props.reference.issued[\"date-parts\"])\n              ? this.props.reference.issued[\"date-parts\"][0][0]\n                : \"\",\n              filterRE\n            )\n          }\n        </div>\n        <div className=\"Ref-list-item-3\">\n          {\n            this.highlighted_text(\n              this.props.reference.title,\n              filterRE\n            )\n          }\n        </div>\n        <div className=\"Ref-list-item-4\">\n          <button type=\"button\" onClick={() => { this.onCitation() }}>Citation</button>\n          <button type=\"button\" onClick={() => { this.doExpand() }}>Expand</button>\n        </div>\n      </div>\n    )\n  }\n\n  highlight_paragraph(text, filterRE) {\n    return text.toString()\n      .split(filterRE)\n      .map((t, index) =>\n        t.match(filterRE)\n          ? (<span className=\"Highlighted\" key={index}>{t}</span>)\n          : t\n      );\n  }\n\n  highlighted_text(text, filterRE) {\n    return (text || \"\").toString().split(\"\\n\").map(\n      (t, index) => (\n        <span key={index} className=\"Ref-paragraph\">\n          {\n            t === \"\" ? (<br/>) :\n              !filterRE\n                ? t\n                : this.highlight_paragraph(t, filterRE)\n          }\n        </span>\n      )\n    )\n  }\n\n  render() {\n    const searchFilter = this.props.visibilityFilter.match(/\\S+/g) || [];  // since match returns null if no match\n\n    const filterRE = searchFilter.length === 0\n      ? null\n      : new RegExp(\"(\" + searchFilter.join(\"|\") + \")\", \"i\");\n\n    if(this.state.isExpanded) {\n      return(this.render_expanded(filterRE))\n    } else {\n      return(this.render_collapsed(filterRE))\n    }\n  }\n}\n\nReference.propTypes = {\n  reference: PropTypes.shape({\n    id: PropTypes.string.isRequired\n  }).isRequired,\n  visibilityFilter: PropTypes.string,\n  hrefRoot: PropTypes.string.isRequired\n};\n\nexport default connect()(Reference)\n","// Copyright (C) 2017, Stefan Kloppenborg\n//\n// This program is free software: you can redistribute it and/or modify\n// it under the terms of the GNU Affero General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU Affero General Public License for more details.\n//\n// You should have received a copy of the GNU Affero General Public License\n// along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nimport React from 'react'\nimport PropTypes from 'prop-types'\nimport Reference from './Reference'\n\nconst ReferenceList = ({references, library, visibilityFilter}) => (\n  <span>\n    <span>\n      {\n        library.hasFailed\n          ? (<div className=\"Error\">Failed to retrieve library. Is the backend server running?</div>)\n          : (<span/>)\n      }\n    </span>\n    <span>\n      {\n        library.hasFailedCitationStyleList\n          ? (<div className=\"Error\">Failed to retrieve citation style list.</div>)\n          : (<span/>)\n      }\n    </span>\n    <span>\n      {\n        library.hasFailedCitationLocale\n          ? (<div className=\"Error\">Failed to retrieve citation locale.</div>)\n          : (<span/>)\n      }\n    </span>\n    <span>\n      {\n        library.isFetching\n          ? (<div>Retrieving Library...</div>)\n          : (\n            <div>\n              {references.map(reference => (\n                <Reference\n                  key={reference.id}\n                  reference={reference}\n                  hrefRoot={library.hrefRoot}\n                  visibilityFilter={visibilityFilter}\n                />\n              ))}\n            </div>\n          )\n      }\n    </span>\n  </span>\n);\n\nReferenceList.propTypes = {\n  references: PropTypes.arrayOf(\n    PropTypes.shape({\n      id: PropTypes.string.isRequired\n    }).isRequired\n  ).isRequired,\n  library: PropTypes.shape({\n    isFetching: PropTypes.bool.isRequired\n  }).isRequired,\n  visibilityFilter: PropTypes.string.isRequired\n};\n\nexport default ReferenceList\n","// Copyright (C) 2017, Stefan Kloppenborg\n//\n// This program is free software: you can redistribute it and/or modify\n// it under the terms of the GNU Affero General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU Affero General Public License for more details.\n//\n// You should have received a copy of the GNU Affero General Public License\n// along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nimport { connect } from 'react-redux'\nimport ReferenceList from '../components/ReferenceList'\nimport { referenceFields } from \"../common/referenceFields\";\n\nconst refFields = referenceFields;\n\nconst getVisibleReferences = (references, filter) => {\n  const uprFilter = filter.toUpperCase().match(/\\S+/g) || [];  // since match returns null if no match\n\n  return references.filter(\n    (r) =>\n      uprFilter.map(flt =>\n        refFields.map(field => {\n          if(!r[field.field]) {\n            return false;\n          }\n          switch(field.type) {\n            case \"NAME\":\n              return r[field.field].map(\n                author => Object.keys(author).map(\n                  key => author[key].toString().toUpperCase().includes(flt)\n                ).reduce((prevVal, elm) => prevVal || elm, false)\n              ).reduce((prevVal, elm) => prevVal || elm, false);\n            case \"DATE\":\n              return r[field.field][\"date-parts\"].toString().toUpperCase().includes(flt);\n            case \"FILE\":\n              return false;\n            default:\n              return r[field.field].toString().toUpperCase().includes(flt)\n          }\n\n        }).reduce((prevVal, elm) => prevVal || elm, false)\n      )\n        .reduce((prevVal, elm) => prevVal && elm, true)\n  );\n};\n\nconst mapStateToProps = state => {\n  return {\n    references: getVisibleReferences(state.references, state.visibilityFilter),\n    library: state.library,\n    visibilityFilter: state.visibilityFilter\n  }\n};\n\nconst mapDispatchToProps = (dispatch, state) => {\n  return {\n    /*onReferenceEditModal: (id) => {\n      dispatch(showEditScreen(id, state.references[0]))\n    }*/\n  }\n};\n\nconst VisibleReferenceList = connect(\n  mapStateToProps,\n  mapDispatchToProps\n)(ReferenceList);\n\nexport default VisibleReferenceList\n","// Copyright (C) 2017, Stefan Kloppenborg\n//\n// This program is free software: you can redistribute it and/or modify\n// it under the terms of the GNU Affero General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU Affero General Public License for more details.\n//\n// You should have received a copy of the GNU Affero General Public License\n// along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nimport React from 'react'\nimport {connect} from 'react-redux'\nimport VisibleReferenceList from \"../containers/VisibleReferenceList\";\nimport {setFilterText, addReference, saveLibrary, importBibLaTeX} from \"../actions\"\n\n\nlet MainScreen = ({library, visibilityFilter, dispatch}) => (\n  <div>\n    <div className=\"Screen-header\">\n      <div className=\"Header-buttons\">\n        <button type=\"button\" id=\"addReference\" className=\"input-field\" onClick={() => dispatch(addReference())}>\n          Add Reference\n        </button>\n        <label htmlFor=\"addReference\">Add Reference</label>\n\n        <input\n          id=\"importBibLaTeX\"\n          type=\"file\"\n          className=\"input-field\"\n          onChange={(e) => {\n            e.preventDefault();\n            const files = [...e.target.files];\n            if (files.length < 1) return;\n            const reader = new FileReader();\n            reader.onload = (e) => {\n              dispatch(importBibLaTeX(e.target.result))\n            };\n            reader.readAsText(files[0]);\n            e.target.value = null;\n          }}\n        />\n        <label htmlFor=\"importBibLaTeX\">Import BibLaTeX</label>\n\n        <button type=\"button\" id=\"exportLibrary\" className=\"input-field\" onClick={() => dispatch(saveLibrary())}>\n          Export Library\n        </button>\n        <label htmlFor=\"exportLibrary\">Export Library</label>\n      </div>\n      <div className=\"Search\">\n        Search:\n        <input\n          type=\"text\"\n          title=\"Search\"\n          size=\"40\"\n          onChange={\n            (event) => {\n              dispatch(setFilterText(event.target.value));\n            }\n          }\n          defaultValue={ visibilityFilter }\n        />\n      </div>\n    </div>\n    <VisibleReferenceList/>\n  </div>\n);\n\nconst mapStateToProps = state => {\n  return {\n    library: state.library,\n    visibilityFilter: state.visibilityFilter\n  }\n};\n\nMainScreen = connect(\n  mapStateToProps\n)(MainScreen);\n\nexport default MainScreen\n","// Copyright (C) 2017, Stefan Kloppenborg\n//\n// This program is free software: you can redistribute it and/or modify\n// it under the terms of the GNU Affero General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU Affero General Public License for more details.\n//\n// You should have received a copy of the GNU Affero General Public License\n// along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nimport React from 'react'\nimport { connect } from 'react-redux'\nimport PropTypes from 'prop-types'\nimport CitationModal from \"./CitationModal\"\nimport EditReferenceModal from \"./EditReferenceScreen\"\nimport MainScreen from \"./MainScreen\"\n\nlet App = ({editReferenceScreen}) => {\n  return (\n    <div className=\"App\">\n      <div className=\"App-header\">\n        <h2>bib-git</h2>\n      </div>\n      <CitationModal/>\n      {editReferenceScreen.isVisible ?\n        (<EditReferenceModal/>) :\n        (<MainScreen/>)\n      }\n    </div>\n  );\n};\n\nconst mapStateToProps = state => {\n\n  return {\n    editReferenceScreen: state.editReferenceScreen\n  }\n};\n\nApp = connect(\n  mapStateToProps\n)(App);\n\nApp.propTypes = {\n  editReferenceScreen: PropTypes.shape({\n    isVisible: PropTypes.bool.isRequired\n  })\n};\n\nexport default App\n","// Copyright (C) 2017, Stefan Kloppenborg\n//\n// This program is free software: you can redistribute it and/or modify\n// it under the terms of the GNU Affero General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU Affero General Public License for more details.\n//\n// You should have received a copy of the GNU Affero General Public License\n// along with this program.  If not, see <https://www.gnu.org/licenses/>.\n\nimport thunkMiddleware from 'redux-thunk'\nimport React from 'react'\nimport { render } from 'react-dom'\nimport { Provider } from 'react-redux'\nimport { createStore, applyMiddleware } from 'redux'\nimport referenceApp from './reducers'\nimport App from './components/App'\nimport './App.css'\nimport {fetchCitationLocale, fetchLibrary, fetchCitationStyle, getFilePathRoot, fetchCitationStyleList } from \"./actions/index\";\n\n\nlet store = createStore(\n  referenceApp,\n  applyMiddleware(\n    thunkMiddleware\n  )\n);\n\nstore.dispatch(fetchLibrary());\nstore.dispatch(fetchCitationStyleList());\nstore.dispatch(fetchCitationLocale());\nstore.dispatch(fetchCitationStyle(\"ieee\"));\nstore.dispatch(getFilePathRoot());\n\nrender(\n  <Provider store={store}>\n    <App />\n  </Provider>,\n  document.getElementById('root')\n);\n"],"sourceRoot":""}